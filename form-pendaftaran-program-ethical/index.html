<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form Program Ethical</title>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCwxPY-M6lwt7JLZEeexUrhKVgVZj_enHE",
        authDomain: "data-outlet-pharos.firebaseapp.com",
        projectId: "data-outlet-pharos",
        storageBucket: "data-outlet-pharos.appspot.com",
        messagingSenderId: "651086534605",
        appId: "1:651086534605:web:228339d21beb359a709684",
        measurementId: "G-7FQQZ2K3T0",
      };

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
    </script>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      type="image/png"
      href="https://connect-assets.prosple.com/cdn/ff/nDJLhKo3GxHUnuJJLt-cRdMGUAmxDY2NSAzboL84_ec/1700559379/public/styles/scale_and_crop_center_120x120/public/2023-11/Logo-Pharos-Indonesia-200x200-2023.jpg?itok=4-AmM7sn"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/@ttskch/select2-bootstrap4-theme@1.5.2/dist/select2-bootstrap4.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap"
      rel="stylesheet"
    />
    <!-- Tambahkan CSS & JS Tom Select -->
    <link
      href="https://cdn.jsdelivr.net/npm/tom-select/dist/css/tom-select.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/tom-select/dist/js/tom-select.complete.min.js"></script>
    <!-- Tambahkan sebelum </head> -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <style>
      body {
        background: #ffffff;
        font-family: "Roboto", sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
      }
      .navbar-custom {
        background-color: #0d6efd;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .navbar-brand {
        display: flex;
        align-items: center;
        font-size: 1.4rem;
        font-weight: bold;
      }

      /* Hover Effect Navbar */
      .navbar-nav .nav-link {
        transition: background-color 0.3s, color 0.3s;
        border-radius: 0.3rem;
      }

      .navbar-nav .nav-link:hover {
        background-color: #0b5ed7;
        color: #fff;
      }
      .card {
        border-radius: 1rem;
        box-shadow: 0 0 30px rgba(13, 110, 253, 0.15);
        background-color: #ffffff;
        padding: 1.5rem 1.75rem;
      }
      .select2-container--bootstrap4 {
        width: 100% !important;
      }
      h2 {
        font-weight: bold;
        margin-bottom: 1rem;
        color: #0d6efd;
      }
      .form-control,
      .form-select {
        border-radius: 0.5rem;
        padding: 0.55rem 0.9rem;
      }
      .btn-primary {
        background-color: #0d6efd;
        border: none;
        padding: 0.65rem;
        font-weight: 500;
        border-radius: 0.5rem;
      }
      .btn-primary:hover {
        background-color: #0b5ed7;
      }
      .form-check {
        margin-bottom: 0.25rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .form-check-input {
        width: 1rem;
        height: 1rem;
        margin: 0;
        margin-right: 0.3rem;
        flex-shrink: 0;
        vertical-align: middle;
      }

      .form-check-label {
        margin: 0;
        font-size: 0.95rem;
        line-height: 1.2;
      }
      ::placeholder {
        color: #bbb !important;
        opacity: 1;
      }
      #loader-wrapper.fade-out {
        opacity: 0;
        transition: opacity 0.5s ease;
        pointer-events: none;
      }
      /* Gaya untuk checkbox agar outline hitam */
      .form-check-input[type="checkbox"] {
        border-color: #000; /* Outline hitam */
      }

      /* Saat dicentang */
      .form-check-input[type="checkbox"]:checked {
        background-color: #0b5ed7; /* Kotak hitam */
        border-color: #000; /* Outline hitam */
      }

      /* Hover agar terlihat interaktif */
      .form-check-input[type="checkbox"]:hover {
        border-color: #0b5ed7;
      }

      /* Fokus agar tetap outline hitam */
      .form-check-input[type="checkbox"]:focus {
        border-color: #000;
        box-shadow: 0 0 0 0.25rem rgba(0, 0, 0, 0.25);
      }
      /* Logo LUMORA */
      .lumora-logo {
        font-family: "Orbitron", sans-serif;
        letter-spacing: 1px;
        font-size: 1.6rem;
        display: inline-block;
        color: #ffd54f;
        animation: goldGlow 3s ease-in-out infinite,
          floatY 4s ease-in-out infinite;
        text-shadow: 0 0 4px #fff8e1, 0 0 8px #ffcc80;
      }

      /* Icon Petir */
      .lightning-icon {
        animation: yellowFlash 2.2s ease-in-out infinite,
          floatY 4s ease-in-out infinite;
        transform-origin: center;
        filter: drop-shadow(0 0 4px #fff8e1) drop-shadow(0 0 8px #ffcc80);
      }

      /* Animasi Glow Teks */
      @keyframes goldGlow {
        0%,
        100% {
          text-shadow: 0 0 4px #fff8e1, 0 0 8px #ffcc80;
          color: #ffd54f;
        }
        50% {
          text-shadow: 0 0 6px #fff4c2, 0 0 12px #ffb74d;
          color: #ffb300;
        }
      }

      /* Animasi Floating */
      @keyframes floatY {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-2px);
        }
      }

      /* Animasi Flash Petir */
      @keyframes yellowFlash {
        0%,
        100% {
          fill: #ffffff;
          filter: drop-shadow(0 0 3px #fff9c4) drop-shadow(0 0 6px #ffecb3);
        }
        50% {
          fill: #ffeb3b;
          filter: drop-shadow(0 0 5px #fff4c2) drop-shadow(0 0 10px #ffd54f);
        }
      }
      .ts-wrapper {
        width: 100%;
      }

      .ts-control {
        padding: 0.375rem 0.75rem;
        border: 1px solid #ced4da;
        border-radius: 0.275rem; /* sama dengan .form-control */
        min-height: calc(1.5em + 0.75rem + 2px);
        font-size: 1rem;
        background-color: #fff;
        color: #212529;
        line-height: 1.5;
        box-shadow: none;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
      }

      .ts-control::placeholder,
      .ts-control input::placeholder,
      .ts-control.single .item {
        color: #6c757d !important;
        opacity: 1 !important;
      }

      .ts-control input {
        font-size: 1rem;
        color: #212529;
        line-height: 1.5;
      }

      .ts-control:focus,
      .ts-control:hover {
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
      }

      .ts-wrapper.single .ts-control {
        display: flex;
        align-items: center;
      }

      .ts-dropdown {
        font-size: 1rem;
        border: 1px solid #ced4da;
        border-radius: 0.375rem;
        z-index: 1000;
      }

      .ts-dropdown .active {
        background-color: #f8f9fa;
      }

      .ts-control .item {
        background: none;
        border: none;
        padding-left: 0;
        color: #212529;
      }

      .ts-control .clear-button {
        color: #6c757d;
        margin-left: auto;
      }
      #avgSalesProgram {
        background-color: rgb(233, 236, 239) !important;
      }
      .select2-clear-wrapper {
        position: relative;
        padding-right: 3.2rem; /* Lebih besar dari lebar tombol */
      }

      .select2-container--default .select2-selection--multiple {
        border: none !important;
        border-radius: 0 !important;
      }

      .select2-container {
        width: 100% !important;
      }

      #clearProdukNeuroBtn {
        position: absolute;
        top: 0;
        right: 0;
        height: 100%;
        width: 2.5rem; /* Lebar tombol, sesuaikan dengan icon */
        z-index: 10;
        border-top-left-radius: 0 !important;
        border-bottom-left-radius: 0 !important;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
      }
    </style>
  </head>
  <!-- Loader -->
  <div
    id="loader-wrapper"
    style="
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #ffffff;
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
    "
  >
    <div
      class="spinner-border text-primary"
      role="status"
      style="width: 4rem; height: 4rem"
    >
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <body>
    <nav
      class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm sticky-top"
    >
      <div class="container">
        <!-- Brand -->
        <a
          class="navbar-brand d-flex align-items-center gap-2 ms-2 me-3"
          href="#"
        >
          <!-- Icon Petir -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            class="bi bi-lightning-charge-fill lightning-icon"
            viewBox="0 0 16 16"
          >
            <path d="M11 0L6 9h4l-1 7 5-10H9l2-6z" />
          </svg>

          <!-- Nama Brand -->
          <span class="text-white lumora-logo animated-logo">Pro-Ethic</span>
        </a>

        <!-- Hamburger Toggle -->
        <button
          class="navbar-toggler ms-auto"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarContent"
          aria-controls="navbarContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Menu Navbar -->
        <div class="collapse navbar-collapse" id="navbarContent">
          <ul class="navbar-nav mt-2 mt-lg-0 ms-2">
            <li class="nav-item">
              <a
                class="nav-link text-white fw-bold ms-1"
                href="https://abednegochristianyoel.github.io/Form-Sales-Force-Effectiveness/form-pendaftaran-program-ethical"
                >Form Ethical</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link text-white fw-bold ms-1"
                href="https://abednegochristianyoel.github.io/Form-Sales-Force-Effectiveness/skp-program-ethical/"
                >List Outlet Program Ethical</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container my-4">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card">
            <h2 class="text-center mb-3 mt-2">
              Form Pengajuan Program Ethical
            </h2>
            <h5 class="fw-bold text-primary mt-1 mb-0 pb-0">Input Data Diri</h5>
            <hr
              class="mx-auto mt-3 mb-3"
              style="border-top: 3px dashed #5f5f5f; width: 100%"
            />
            <form id="ethicalForm">
              <div class="row g-3 align-items-end">
                <div class="col-md-8">
                  <label for="nipEthical" class="form-label">NIP</label>
                  <input
                    type="text"
                    id="nipEthical"
                    class="form-control"
                    placeholder="Masukkan NIP"
                    required
                  />
                </div>
                <div class="col-md-4">
                  <button
                    type="button"
                    class="btn btn-primary w-100"
                    id="searchEthicalBtn"
                  >
                    Validasi NIP
                  </button>
                </div>

                <div class="col-12">
                  <label class="form-label">Nama</label>
                  <input
                    type="text"
                    id="namaEthical"
                    class="form-control"
                    disabled
                  />
                </div>

                <div class="col-md-6">
                  <label class="form-label">Jabatan</label>
                  <input
                    type="text"
                    id="jabatanEthical"
                    class="form-control"
                    disabled
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Divisi</label>
                  <input
                    type="text"
                    id="divisiEthical"
                    class="form-control"
                    disabled
                  />
                </div>
                <div class="col-12 mb-2 mt-4">
                  <h5 class="fw-bold text-primary mt-1 mb-3">
                    Input Detail Program
                  </h5>
                  <hr class="my-2" style="border-top: 3px dashed #5f5f5f" />
                </div>

                <div class="col-md-6 mt-0 mb-3 mb-md-0">
                  <label for="outletEthical" class="form-label"
                    >Kode Outlet</label
                  >
                  <select id="outletEthical" required>
                    <option value="">Pilih Outlet</option>
                  </select>
                </div>
                <div class="col-md-6 mt-0">
                  <label for="programEthical" class="form-label"
                    >Pilih Program</label
                  >
                  <select id="programEthical" class="form-select" required>
                    <option value="">Pilih Program</option>
                    <option value="Boost Metabolic">Boost Metabolic</option>
                    <option value="Presentasi Produk Neuro Pain Metabolic">
                      Presentasi Produk Neuro Pain Metabolic
                    </option>
                    <option value="Insentif SC Modafil & Rozgra">
                      Insentif SC Modafil & Rozgra
                    </option>
                    <option value="POP">POP</option>
                    <option value="PGD">PGD</option>
                    <option value="PK to PBF">PK to PBF</option>
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="form-label">Kode PI</label>
                  <input
                    type="text"
                    id="kodePiEthical"
                    class="form-control"
                    disabled
                  />
                </div>

                <div class="col-md-6">
                  <label class="form-label">Nama Outlet</label>
                  <input
                    type="text"
                    id="namaOutletEthical"
                    class="form-control"
                    disabled
                  />
                </div>

                <div class="col-md-6">
                  <label class="form-label">Kota</label>
                  <input
                    type="text"
                    id="kotaOutletEthical"
                    class="form-control"
                    disabled
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Alamat Outlet</label>
                  <input
                    type="text"
                    id="alamatOutletEthical"
                    class="form-control"
                    disabled
                  />
                </div>

                <!-- 🔹 Field Nama Owner/Apotek untuk Insentif SC -->
                <div id="ownerFieldsInsentif" class="col-12 d-none">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label">Nama Owner / Apotek</label>
                      <input
                        type="text"
                        class="form-control"
                        id="namaOwnerInsentif"
                        placeholder="Masukkan Nama Owner / Apoteker"
                      />
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="form-label">No. Telp / WA</label>
                      <input
                        type="tel"
                        class="form-control"
                        id="telpOwnerInsentif"
                        placeholder="Contoh: 0878213512311"
                        pattern="08[0-9]{8,13}"
                        maxlength="15"
                        oninvalid="this.setCustomValidity('Nomor harus diawali 08 dan terdiri dari 10–15 digit angka')"
                        oninput="this.setCustomValidity('')"
                      />
                    </div>
                  </div>
                </div>

                <!-- Detail E-Wallet -->
                <div id="ewalletFields" class="col-12 d-none mt-0">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label">Jenis E-Wallet</label>
                      <select id="jenisEwallet" class="form-select">
                        <option value="">Pilih E-Wallet</option>
                        <option value="Dana">Dana</option>
                        <option value="Gopay">Gopay</option>
                        <option value="Ovo">Ovo</option>
                        <option value="ShopeePay">ShopeePay</option>
                      </select>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="form-label">No. Akun E-Wallet</label>
                      <input
                        type="tel"
                        id="noTelpEwallet"
                        class="form-control"
                        placeholder="Contoh: 0878213512311"
                        pattern="08[0-9]{8,13}"
                        maxlength="15"
                        oninvalid="this.setCustomValidity('Nomor harus diawali 08 dan terdiri dari 10–15 digit angka')"
                        oninput="this.setCustomValidity('')"
                      />
                    </div>
                    <div class="col-12 mb-3">
                      <label class="form-label">Nama Akun E-Wallet</label>
                      <input
                        type="text"
                        id="namaAkunEwallet"
                        class="form-control"
                        placeholder="Contoh: abednegoefra"
                      />
                    </div>
                  </div>
                </div>

                <!-- Detail Transfer Bank -->
                <div id="bankFields" class="col-12 d-none">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label">Nama Bank</label>
                      <input
                        type="text"
                        id="namaBank"
                        class="form-control"
                        placeholder="Masukkan Nama Bank"
                      />
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="form-label">No. Rekening</label>
                      <input
                        type="text"
                        id="noRek"
                        class="form-control"
                        placeholder="Masukkan Nomor Rekening"
                        pattern="[0-9]{8,20}"
                        oninvalid="this.setCustomValidity('Nomor harus terdiri dari 8-20 digit angka')"
                        oninput="this.setCustomValidity('')"
                      />
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="form-label">Nama Akun Bank</label>
                      <input
                        type="text"
                        id="namaAkunBank"
                        class="form-control"
                        placeholder="Masukkan Nama Akun Bank"
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Cabang Bank</label>
                      <input
                        type="text"
                        id="cabangBank"
                        class="form-control"
                        placeholder="Masukkan Cabang Bank"
                      />
                    </div>
                  </div>
                </div>

                <!-- Field Produk Pediatrik untuk Program POP -->
                <div id="produkPediatrikWrapper" class="col-12 d-none">
                  <div class="row">
                    <div class="mb-2">
                      <label class="form-label fw-bold"
                        >Pilihan Produk Pediatrik</label
                      >
                    </div>
                    <div class="col-md-6 mb-2">
                      <div class="form-check d-flex align-items-center gap-2">
                        <input
                          class="form-check-input produkPediatrikSwitch"
                          type="checkbox"
                          id="BINOMIC"
                          data-label="BINOMIC SYRUP 60 ML"
                        />
                        <label class="form-check-label mb-0" for="BINOMIC"
                          >BINOMIC SYRUP 60 ML</label
                        >
                      </div>
                    </div>
                    <div class="col-md-6 mb-2">
                      <div class="form-check d-flex align-items-center gap-2">
                        <input
                          class="form-check-input produkPediatrikSwitch"
                          type="checkbox"
                          id="CANDISTIN"
                          data-label="CANDISTIN DROPS 12 ML"
                        />
                        <label class="form-check-label mb-0" for="CANDISTIN"
                          >CANDISTIN DROPS 12 ML</label
                        >
                      </div>
                    </div>
                    <div class="col-md-6 mb-2">
                      <div class="form-check d-flex align-items-center gap-2">
                        <input
                          class="form-check-input produkPediatrikSwitch"
                          type="checkbox"
                          id="CLINOVIR"
                          data-label="CLINOVIR GROUP"
                        />
                        <label class="form-check-label mb-0" for="CLINOVIR"
                          >CLINOVIR GROUP</label
                        >
                      </div>
                    </div>
                    <div class="col-md-6 mb-2">
                      <div class="form-check d-flex align-items-center gap-2">
                        <input
                          class="form-check-input produkPediatrikSwitch"
                          type="checkbox"
                          id="ETHIROS"
                          data-label="ETHIROS DRY SYRUP 60 ML"
                        />
                        <label class="form-check-label mb-0" for="ETHIROS"
                          >ETHIROS DRY SYRUP 60 ML</label
                        >
                      </div>
                    </div>
                    <div class="col-md-6 mb-2">
                      <div class="form-check d-flex align-items-center gap-2">
                        <input
                          class="form-check-input produkPediatrikSwitch"
                          type="checkbox"
                          id="IFLACORT"
                          data-label="IFLACORT CREAM GROUP"
                        />
                        <label class="form-check-label mb-0" for="IFLACORT"
                          >IFLACORT CREAM GROUP</label
                        >
                      </div>
                    </div>
                    <div class="col-md-6 mb-2">
                      <div class="form-check d-flex align-items-center gap-2">
                        <input
                          class="form-check-input produkPediatrikSwitch"
                          type="checkbox"
                          id="NARFOZ"
                          data-label="NARFOZ SYRUP GRUP"
                        />
                        <label class="form-check-label mb-0" for="NARFOZ"
                          >NARFOZ SYRUP GRUP</label
                        >
                      </div>
                    </div>
                    <div class="col-md-6 mb-2">
                      <div class="form-check d-flex align-items-center gap-2">
                        <input
                          class="form-check-input produkPediatrikSwitch"
                          type="checkbox"
                          id="OROXIN"
                          data-label="OROXIN SYRUP 60 ML"
                        />
                        <label class="form-check-label mb-0" for="OROXIN"
                          >OROXIN SYRUP 60 ML</label
                        >
                      </div>
                    </div>
                    <div class="col-md-6 mb-2">
                      <div class="form-check d-flex align-items-center gap-2">
                        <input
                          class="form-check-input produkPediatrikSwitch"
                          type="checkbox"
                          id="OZEN"
                          data-label="OZEN DROPS 12 ML"
                        />
                        <label class="form-check-label mb-0" for="OZEN"
                          >OZEN DROPS 12 ML</label
                        >
                      </div>
                    </div>
                    <div class="col-md-6 mb-2">
                      <div class="form-check d-flex align-items-center gap-2">
                        <input
                          class="form-check-input produkPediatrikSwitch"
                          type="checkbox"
                          id="PRAXION"
                          data-label="PRAXION DROPS"
                        />
                        <label class="form-check-label mb-0" for="PRAXION"
                          >PRAXION DROPS</label
                        >
                      </div>
                    </div>
                    <div class="col-md-6 mb-2">
                      <div class="form-check d-flex align-items-center gap-2">
                        <input
                          class="form-check-input produkPediatrikSwitch"
                          type="checkbox"
                          id="PRORIS"
                          data-label="PRORIS SUPPOSITORIA"
                        />
                        <label class="form-check-label mb-0" for="PRORIS"
                          >PRORIS SUPPOSITORIA</label
                        >
                      </div>
                    </div>
                    <div class="col-md-6 mb-2">
                      <div class="form-check d-flex align-items-center gap-2">
                        <input
                          class="form-check-input produkPediatrikSwitch"
                          type="checkbox"
                          id="TAXILAN"
                          data-label="TAXILAN SYRUP"
                        />
                        <label class="form-check-label mb-0" for="TAXILAN"
                          >TAXILAN SYRUP</label
                        >
                      </div>
                    </div>
                    <div class="col-md-6 mb-2">
                      <div class="form-check d-flex align-items-center gap-2">
                        <input
                          class="form-check-input produkPediatrikSwitch"
                          type="checkbox"
                          id="VIRIDIS"
                          data-label="VIRIDIS GROUP"
                        />
                        <label class="form-check-label mb-0" for="VIRIDIS"
                          >VIRIDIS GROUP</label
                        >
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Tambahan untuk Program POP dan PGD -->
                <div id="popPgdFields" class="col-12 d-none mt-3">
                  <div class="row">
                    <div class="col-md-6 mb-3" id="tanggalRealisasiPopWrapper">
                      <label class="form-label"
                        >Estimasi Tanggal Realisasi</label
                      >
                      <input
                        type="text"
                        id="tanggalRealisasiPop"
                        class="form-control"
                        placeholder="DD/MM/YYYY"
                        autocomplete="off"
                      />
                    </div>

                    <div class="col-md-6 mb-3" id="tanggalRealisasiPgdWrapper">
                      <label class="form-label"
                        >Estimasi Tanggal Realisasi</label
                      >
                      <input
                        type="text"
                        id="tanggalRealisasiPgd"
                        class="form-control"
                        placeholder="DD/MM/YYYY"
                        autocomplete="off"
                      />
                    </div>
                    <div class="col-md-6 mb-3 d-none" id="pesertaPopWrapper">
                      <label class="form-label"
                        >Jumlah Peserta (Pack), Include PSR</label
                      >
                      <input
                        type="number"
                        id="jumlahPesertaPop"
                        class="form-control"
                        min="1"
                        placeholder="Masukkan Jumlah Peserta (Termasuk PSR)"
                      />
                    </div>
                    <div class="col-md-6 mb-3 d-none" id="pesertaPgdWrapper">
                      <label class="form-label"
                        >Jumlah Peserta (Pack), Maks 3 Orang / Outlet</label
                      >
                      <input
                        type="number"
                        id="jumlahPesertaPgd"
                        class="form-control"
                        min="1"
                        max="3"
                        placeholder="Maksimal 3 Orang / Outlet"
                        oninvalid="this.setCustomValidity('Maksimal 3 Orang / Outlet')"
                        oninput="this.setCustomValidity('')"
                      />
                    </div>
                  </div>
                </div>

                <div id="salesPGDFields" class="col-12 d-none mt-0">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label">Total Sales Program</label>
                      <div class="input-group">
                        <span class="input-group-text">Rp</span>
                        <input
                          type="text"
                          id="totalSalesProgram"
                          class="form-control"
                          placeholder="Masukkan Total Sales Program"
                          pattern="[0-9,.]*"
                          inputmode="numeric"
                        />
                      </div>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="form-label"
                        >Avg Sales Program (6 Bulan)</label
                      >
                      <div class="input-group">
                        <span class="input-group-text">Rp</span>
                        <input
                          type="text"
                          id="avgSalesProgram"
                          class="form-control bg-light"
                          placeholder="Masukkan Avg Sales Program"
                          pattern="[0-9,.]*"
                          inputmode="numeric"
                          readonly
                          tabindex="-1"
                        />
                      </div>
                    </div>
                  </div>
                </div>

                <div id="tempatPelaksanaanWrapper" class="col-12 d-none mt-0">
                  <div class="row">
                    <div class="col-12 mb-3">
                      <label class="form-label"
                        >Tempat Pelaksanaan (Tentatif)</label
                      >
                      <input
                        type="text"
                        id="tempatPelaksanaan"
                        class="form-control"
                        placeholder="Masukkan Tempat Pelaksanaan PGD"
                      />
                    </div>
                  </div>
                </div>

                <div id="boostMetabolicFields" class="col-12 d-none">
                  <div class="row">
                    <!-- Pilihan Produk -->
                    <div id="produkSwitchWrapper" class="col-12 d-none">
                      <div class="mb-2">
                        <label class="form-label fw-bold">Pilihan Produk</label>
                      </div>
                      <div class="row">
                        <div class="col-md-3 mb-2">
                          <div
                            class="form-check d-flex align-items-center gap-2"
                          >
                            <input
                              class="form-check-input produkSwitch"
                              type="checkbox"
                              id="Profibrat200"
                              data-label="Profibrat 200 mg"
                            />
                            <label
                              class="form-check-label mb-0"
                              for="Profibrat200"
                              >Profibrat 200 mg</label
                            >
                          </div>
                        </div>
                        <div class="col-md-3 mb-2">
                          <div
                            class="form-check d-flex align-items-center gap-2"
                          >
                            <input
                              class="form-check-input produkSwitch"
                              type="checkbox"
                              id="Stavinor10"
                              data-label="Stavinor 10 mg"
                            />
                            <label
                              class="form-check-label mb-0"
                              for="Stavinor10"
                              >Stavinor 10 mg</label
                            >
                          </div>
                        </div>
                        <div class="col-md-3 mb-2">
                          <div
                            class="form-check d-flex align-items-center gap-2"
                          >
                            <input
                              class="form-check-input produkSwitch"
                              type="checkbox"
                              id="Stavinor20"
                              data-label="Stavinor 20 mg"
                            />
                            <label
                              class="form-check-label mb-0"
                              for="Stavinor20"
                              >Stavinor 20 mg</label
                            >
                          </div>
                        </div>
                        <div class="col-md-3 mb-2">
                          <div
                            class="form-check d-flex align-items-center gap-2"
                          >
                            <input
                              class="form-check-input produkSwitch"
                              type="checkbox"
                              id="Stavinor40"
                              data-label="Stavinor 40 mg"
                            />
                            <label
                              class="form-check-label mb-0"
                              for="Stavinor40"
                              >Stavinor 40 mg</label
                            >
                          </div>
                        </div>
                        <div class="col-md-3 mb-2">
                          <div
                            class="form-check d-flex align-items-center gap-2"
                          >
                            <input
                              class="form-check-input produkSwitch"
                              type="checkbox"
                              id="Vastrol10"
                              data-label="Vastrol 10 mg"
                            />
                            <label class="form-check-label mb-0" for="Vastrol10"
                              >Vastrol 10 mg</label
                            >
                          </div>
                        </div>
                        <div class="col-md-3 mb-2">
                          <div
                            class="form-check d-flex align-items-center gap-2"
                          >
                            <input
                              class="form-check-input produkSwitch"
                              type="checkbox"
                              id="Vastrol20"
                              data-label="Vastrol 20 mg"
                            />
                            <label class="form-check-label mb-0" for="Vastrol20"
                              >Vastrol 20 mg</label
                            >
                          </div>
                        </div>
                        <div class="col-md-3 mb-2">
                          <div
                            class="form-check d-flex align-items-center gap-2"
                          >
                            <input
                              class="form-check-input produkSwitch"
                              type="checkbox"
                              id="Rechol10"
                              data-label="Rechol 10 mg"
                            />
                            <label class="form-check-label mb-0" for="Rechol10"
                              >Rechol 10 mg</label
                            >
                          </div>
                        </div>
                        <div class="col-md-3 mb-2">
                          <div
                            class="form-check d-flex align-items-center gap-2"
                          >
                            <input
                              class="form-check-input produkSwitch"
                              type="checkbox"
                              id="Rechol20"
                              data-label="Rechol 20 mg"
                            />
                            <label class="form-check-label mb-0" for="Rechol20"
                              >Rechol 20 mg</label
                            >
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Form Apoteker -->
                    <div class="col-md-12 mb-3 mt-1">
                      <label for="namaApoteker" class="form-label"
                        >Nama Owner / Apoteker</label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="namaApoteker"
                        name="namaApoteker"
                        placeholder="Masukkan Nama Owner / Apoteker"
                      />
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="telpApoteker" class="form-label"
                        >No. Telp / WA</label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="telpApoteker"
                        name="telpApoteker"
                        placeholder="Contoh: 0878213512311"
                        pattern="08[0-9]{8,13}"
                        maxlength="15"
                        oninvalid="this.setCustomValidity('Nomor harus diawali 08 dan terdiri dari 10–15 digit angka')"
                        oninput="this.setCustomValidity('')"
                      />
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="emailApoteker" class="form-label"
                        >Email</label
                      >
                      <input
                        type="email"
                        class="form-control"
                        id="emailApoteker"
                        name="emailApoteker"
                        placeholder="Contoh: abed@pharos.co.id"
                        oninvalid="this.setCustomValidity('Silakan masukkan email yang valid')"
                        oninput="this.setCustomValidity('')"
                      />
                    </div>
                  </div>
                </div>

                <div id="presentasiNeuroFields" class="col-12 d-none mt-0">
                  <div class="row">
                    <!-- Item Boost Metabolic (gunakan field produkSwitchWrapper yang sudah ada) -->
                    <div class="col-12 mb-3 mt-3">
                      <label class="form-label fw-bold"
                        >Pilih Produk Neuro Pain Metabolic</label
                      >
                      <div class="select2-clear-wrapper position-relative p-0">
                        <select id="produkNeuroSelect" multiple></select>
                        <button
                          type="button"
                          id="clearProdukNeuroBtn"
                          class="btn btn-outline-danger clear-btn me-0"
                          title="Hapus semua pilihan"
                        >
                          <i class="bi bi-trash" style="font-size: 1.2rem"></i>
                        </button>
                      </div>
                    </div>

                    <div class="col-md-12 mb-3">
                      <label class="form-label">Tanggal Presentasi</label>
                      <input
                        type="text"
                        id="tanggalPresentasiNeuro"
                        class="form-control"
                        placeholder="DD/MM/YYYY"
                        autocomplete="off"
                      />
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="form-label">Jumlah Peserta</label>
                      <input
                        type="number"
                        id="jumlahPesertaNeuro"
                        class="form-control"
                        min="1"
                        placeholder="Masukkan Jumlah Peserta"
                      />
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="form-label">Total Biaya (Rp)</label>
                      <div class="input-group">
                        <span class="input-group-text">Rp</span>
                        <input
                          type="text"
                          id="biayaNeuro"
                          class="form-control bg-light"
                          placeholder="Total Biaya"
                          readonly
                          tabindex="-1"
                          style="background-color: rgb(233, 236, 239)"
                        />
                      </div>
                    </div>
                  </div>
                </div>

                <div id="tanggalPelaksanaanPK" class="mb-3 d-none">
                  <div class="row">
                    <div class="col-md-6">
                      <label for="tanggalPK" class="form-label"
                        >Tanggal Pelaksanaan</label
                      >
                      <input
                        type="text"
                        id="tanggalPK"
                        class="form-control"
                        placeholder="DD/MM/YYYY"
                        autocomplete="off"
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="jumlahPesertaPK" class="form-label"
                        >Jumlah Peserta</label
                      >
                      <input
                        type="number"
                        id="jumlahPesertaPK"
                        class="form-control"
                        min="1"
                        placeholder="Masukkan Jumlah Peserta"
                      />
                    </div>
                  </div>
                </div>

                <div class="col-12 mt-1 mt-4">
                  <div class="ps-2 pt-1 border border-dark border-2 rounded">
                    <div class="form-check d-flex align-items-center">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="confirmCheck"
                        required
                      />
                      <label
                        class="form-check-label fw-medium"
                        for="confirmCheck"
                      >
                        <strong
                          >SAYA MENYATAKAN DATA YANG DIISI SUDAH BENAR</strong
                        >
                      </label>
                    </div>
                  </div>
                </div>

                <div class="col-12 mt-4">
                  <button type="submit" class="btn btn-primary w-100">
                    Submit Data
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script>
      const scriptURL =
        "https://script.google.com/macros/s/AKfycby8yvOjfrRMHBQVT-X6JmdJcfS2lkzyCwLvxVpkci_WIcYiCZDtp59_IM08tyGufog-bQ/exec";
      let globalOutletData = {};

      // Fungsi untuk mengatur required secara dinamis
      function setFieldRequired(selector, required = true) {
        const field = document.querySelector(selector);
        if (field) {
          if (required) {
            field.setAttribute("required", "required");
          } else {
            field.removeAttribute("required");
          }
        }
      }
      // Fungsi untuk reset semua field setelah biodata
      function resetFormSetelahBiodata() {
        const fieldsToClear = [
          "#outletEthical",
          "#programEthical",
          "#kodePiEthical",
          "#namaOutletEthical",
          "#kotaOutletEthical",
          "#alamatOutletEthical",
          "#jenisEwallet",
          "#noTelpEwallet",
          "#namaAkunEwallet",
          "#namaBank",
          "#noRek",
          "#namaAkunBank",
          "#cabangBank",
          "#tanggalRealisasiPop",
          "#tanggalRealisasiPgd",
          "#jumlahPesertaPop",
          "#jumlahPesertaPgd",
          "#Profibrat200",
          "#Stavinor10",
          "#Stavinor20",
          "#Stavinor40",
          "#Vastrol10",
          "#Vastrol20",
          "#Rechol10",
          "#Rechol20",
          "#tempatPelaksanaan",
          "#totalSalesProgram",
          "#avgSalesProgram",
          "#jumlahPesertaPK",
        ];

        fieldsToClear.forEach((id) => {
          const el = document.querySelector(id);
          if (el) el.value = "";
        });

        if (tomOutletSelect) tomOutletSelect.clear();
        $("#programEthical").val(null).trigger("change");
        $("#confirmCheck").prop("checked", false);
        $("#ewalletFields").addClass("d-none");
        $("#bankFields").addClass("d-none");
        $("#popPgdFields").addClass("d-none");
        $("#boostMetabolicFields").addClass("d-none");
        $("#produkSwitchWrapper").addClass("d-none");
        $("#tempatPelaksanaanWrapper").addClass("d-none");
        $("#tanggalPelaksanaanPK").addClass("d-none");
        $("#produkPediatrikWrapper").addClass("d-none");

        [
          "#jenisEwallet",
          "#noTelpEwallet",
          "#namaAkunEwallet",
          "#namaBank",
          "#noRek",
          "#namaAkunBank",
          "#cabangBank",
          "#tanggalRealisasiPop",
          "#tanggalRealisasiPgd",
          "#jumlahPesertaPop",
          "#jumlahPesertaPgd",
          "#tempatPelaksanaan",
        ].forEach((id) => setFieldRequired(id, false));
      }

      let tomOutletSelect;

      function initTomSelectOutlet(dataOutlets) {
        const select = document.getElementById("outletEthical");

        // Kosongkan opsi sebelumnya
        select.innerHTML = `<option value="">Pilih Outlet</option>`;

        const options = (dataOutlets || []).map((outlet) => {
          const kode = outlet.kode;
          globalOutletData[kode] = outlet;
          return {
            value: kode,
            text: `${kode}`,
          };
        });

        if (tomOutletSelect) tomOutletSelect.destroy();

        tomOutletSelect = new TomSelect(select, {
          options,
          placeholder: "Pilih Outlet",
          allowEmptyOption: true,
          closeAfterSelect: true,
          plugins: ["clear_button"],
          maxOptions: 1000,
        });
      }
      $("#programEthical").select2({
        theme: "bootstrap4",
        placeholder: "Pilih Program",
        allowClear: true,
      });

      function formatRupiah(angka) {
        if (!angka) return "";
        // Hilangkan semua karakter selain angka
        angka = angka.replace(/\D/g, "");
        // Format ribuan
        return angka.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
      }

      // Event untuk format otomatis saat input
      $("#totalSalesProgram, #avgSalesProgram").on("input", function () {
        const val = $(this).val().replace(/\D/g, "");
        $(this).val(formatRupiah(val));
      });

      document
        .getElementById("searchEthicalBtn")
        .addEventListener("click", () => {
          const nip = document.getElementById("nipEthical").value.trim();
          if (!nip)
            return Swal.fire(
              "Perhatian",
              "Harap isi NIP terlebih dahulu.",
              "warning"
            );

          Swal.fire({
            title: "Mencari data...",
            allowOutsideClick: false,
            didOpen: () => Swal.showLoading(),
          });

          fetch(
            `https://data-outlet-pharos-default-rtdb.firebaseio.com/${nip}.json`
          )
            .then((res) => res.json())
            .then((data) => {
              Swal.close();

              if (!data || !data.nama)
                return Swal.fire(
                  "Tidak Ditemukan",
                  "Data NIP tidak ditemukan.",
                  "error"
                );

              document.getElementById("namaEthical").value = data.nama || "";
              document.getElementById("jabatanEthical").value =
                data.jabatan || "";
              document.getElementById("divisiEthical").value =
                data.divisi || "";

              resetFormSetelahBiodata();

              const jabatan = (data.jabatan || "").toUpperCase();
              const divisi = (data.divisi || "").toUpperCase();
              const programSelect = document.getElementById("programEthical");

              // Reset program
              programSelect.innerHTML = `
            <option value="">Pilih Program</option>
            <option value="Boost Metabolic">Boost Metabolic</option>
            <option value="Presentasi Produk Neuro Pain Metabolic">Presentasi Produk Neuro Pain Metabolic</option>
            <option value="Insentif SC Modafil & Rozgra">Insentif SC Modafil & Rozgra</option>
            <option value="POP">POP</option>
            <option value="PGD">PGD</option>
          `;

              if (
                jabatan === "NSM" &&
                (divisi === "VBR" || divisi === "MSA1")
              ) {
                const optionPK = document.createElement("option");
                optionPK.value = "PK to PBF";
                optionPK.textContent = "PK to PBF";
                programSelect.appendChild(optionPK);
              }

              $("#programEthical").val(null).trigger("change");

              globalOutletData = {};
              initTomSelectOutlet(data.outlets || []);
            })
            .catch((err) => {
              console.error("Fetch error:", err);
              Swal.close();
              Swal.fire({
                icon: "error",
                title: "Gagal Mengambil Data",
                html: `Terjadi kesalahan saat mengambil data dari server.<br><small>${
                  err.message || err
                }</small>`,
              });
            });
        });

      document
        .getElementById("ethicalForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const nip = document.getElementById("nipEthical").value.trim();
          const outlet = document.getElementById("outletEthical").value;
          const program = document.getElementById("programEthical").value;
          const kodePi = document.getElementById("kodePiEthical").value;
          const namaOutlet = document.getElementById("namaOutletEthical").value;
          const kota = document.getElementById("kotaOutletEthical").value;
          const alamat = document.getElementById("alamatOutletEthical").value;

          if (!nip || !outlet || !program) {
            return Swal.fire(
              "Lengkapi Form",
              "Mohon isi semua field wajib.",
              "warning"
            );
          }

          if (program === "PGD") {
            if (!document.getElementById("tanggalRealisasiPgd").value.trim()) {
              return Swal.fire(
                "Lengkapi Tanggal",
                "Tanggal realisasi wajib diisi untuk program PGD.",
                "warning"
              );
            }
            const jumlahPeserta = Number(
              document.getElementById("jumlahPesertaPgd").value
            );
            if (!jumlahPeserta || jumlahPeserta < 1 || jumlahPeserta > 3) {
              return Swal.fire(
                "Jumlah Peserta Tidak Valid",
                "Jumlah peserta untuk PGD harus 1-3 orang.",
                "warning"
              );
            }
            if (
              !document.getElementById("totalSalesProgram").value.trim() ||
              !document.getElementById("avgSalesProgram").value.trim()
            ) {
              return Swal.fire(
                "Lengkapi Data Sales",
                "Total sales dan average sales wajib diisi untuk PGD.",
                "warning"
              );
            }
          } else if (program === "Boost Metabolic") {
            if (
              !document.getElementById("namaApoteker").value.trim() ||
              !document.getElementById("telpApoteker").value.trim() ||
              !document.getElementById("emailApoteker").value.trim()
            ) {
              return Swal.fire(
                "Lengkapi Data Apoteker",
                "Nama, Telepon, dan Email apoteker wajib diisi untuk Boost Metabolic.",
                "warning"
              );
            }
            const checkedProduk = document.querySelectorAll(
              '#produkSwitchWrapper input[type="checkbox"]:checked'
            );
            if (checkedProduk.length === 0) {
              return Swal.fire(
                "Pilih Produk",
                "Minimal pilih satu produk untuk Boost Metabolic.",
                "warning"
              );
            }
          } else if (program === "Presentasi Produk Neuro Pain Metabolic") {
            if (
              !document.getElementById("tanggalPresentasiNeuro").value.trim()
            ) {
              return Swal.fire(
                "Lengkapi Tanggal",
                "Tanggal presentasi wajib diisi untuk program ini.",
                "warning"
              );
            }
            if (!document.getElementById("jumlahPesertaNeuro").value.trim()) {
              return Swal.fire(
                "Lengkapi Jumlah Peserta",
                "Jumlah peserta wajib diisi untuk presentasi ini.",
                "warning"
              );
            }
            const produkNeuroSelected = $("#produkNeuroSelect").val() || [];
            if (produkNeuroSelected.length === 0) {
              return Swal.fire(
                "Pilih Produk",
                "Minimal pilih satu produk untuk Presentasi Produk Neuro.",
                "warning"
              );
            }
          } else if (program === "PK to PBF") {
            if (!document.getElementById("tanggalPK").value.trim()) {
              return Swal.fire(
                "Lengkapi Tanggal",
                "Tanggal pelaksanaan wajib diisi untuk PK to PBF.",
                "warning"
              );
            }
            if (!document.getElementById("jumlahPesertaPK").value.trim()) {
              return Swal.fire(
                "Lengkapi Jumlah Peserta",
                "Jumlah peserta wajib diisi untuk PK to PBF.",
                "warning"
              );
            }
          } else if (program === "POP") {
            if (!document.getElementById("tanggalRealisasiPop").value.trim()) {
              return Swal.fire(
                "Lengkapi Tanggal",
                "Tanggal realisasi wajib diisi untuk program POP.",
                "warning"
              );
            }
          }

          const baseData = {
            nip,
            nama: document.getElementById("namaEthical").value,
            jabatan: document.getElementById("jabatanEthical").value,
            divisi: document.getElementById("divisiEthical").value,
            outlet,
            program,
            kodePi,
            namaOutlet,
            kota,
            alamat,
          };

          if (program === "Insentif SC Modafil & Rozgra") {
            baseData.namaOwner =
              document.getElementById("namaOwnerInsentif").value || "";
            baseData.telpOwner =
              document.getElementById("telpOwnerInsentif").value || "";
            baseData.jenisEwallet =
              document.getElementById("jenisEwallet").value || "";
            baseData.noTelpEwallet =
              document.getElementById("noTelpEwallet").value || "";
            baseData.namaAkunEwallet =
              document.getElementById("namaAkunEwallet").value || "";
          } else if (program === "POP") {
            baseData.tanggalRealisasi = document.getElementById(
              "tanggalRealisasiPop"
            ).value;
            baseData.jumlahPeserta =
              document.getElementById("jumlahPesertaPop").value;
            const pediatrikSwitches = document.querySelectorAll(
              ".produkPediatrikSwitch"
            );

            const produkPediatrikStatus = Array.from(pediatrikSwitches).map(
              (sw) => ({
                label: sw.dataset.label,
                status: sw.checked ? "Yes" : "No",
              })
            );

            baseData.productPediatrik = JSON.stringify(produkPediatrikStatus);
          } else if (program === "PGD") {
            baseData.tanggalRealisasi = document.getElementById(
              "tanggalRealisasiPgd"
            ).value;
            baseData.jumlahPeserta =
              document.getElementById("jumlahPesertaPgd").value;
            // ...checker...
            if (
              !baseData.jumlahPeserta ||
              Number(baseData.jumlahPeserta) < 1 ||
              Number(baseData.jumlahPeserta) > 3
            ) {
              Swal.fire(
                "Jumlah Peserta Tidak Valid",
                "Jumlah peserta untuk PGD harus 1-3 orang per outlet.",
                "warning"
              );
              return;
            }
            baseData.tempatPelaksanaan =
              document.getElementById("tempatPelaksanaan").value || "";
            baseData.totalSalesProgram =
              document
                .getElementById("totalSalesProgram")
                .value.replace(/\./g, "") || "";
            baseData.avgSalesProgram =
              document
                .getElementById("avgSalesProgram")
                .value.replace(/\./g, "") || "";
          } else if (program === "Boost Metabolic") {
            baseData.namaApoteker =
              document.getElementById("namaApoteker").value || "";
            baseData.telpApoteker =
              document.getElementById("telpApoteker").value || "";
            baseData.emailApoteker =
              document.getElementById("emailApoteker").value || "";

            const switches = document.querySelectorAll(".produkSwitch");

            const produkStatus = Array.from(switches).map((sw) => ({
              label: sw.dataset.label,
              status: sw.checked ? "Yes" : "No",
            }));

            baseData.productMetabolic = JSON.stringify(produkStatus);
          } else if (program === "Presentasi Produk Neuro Pain Metabolic") {
            baseData.tanggalPresentasi =
              document.getElementById("tanggalPresentasiNeuro").value || "";
            baseData.jumlahPeserta =
              document.getElementById("jumlahPesertaNeuro").value || "";
            baseData.biaya = (document.getElementById("biayaNeuro").value || "")
              .replace(/\./g, "")
              .replace(/,/g, "");
            // Ambil produk Neuro Metabolic yang dipilih di wrapper presentasi
            const produkNeuroSelected = $("#produkNeuroSelect").val() || [];
            if (produkNeuroSelected.length === 0) {
              Swal.fire(
                "Pilih Produk",
                "Minimal pilih satu produk untuk Presentasi Produk Neuro.",
                "warning"
              );
              return;
            }
            // Buat array objek sesuai format lama
            const produkNeuroStatus = produkNeuroList.map((label) => ({
              label,
              status: produkNeuroSelected.includes(label) ? "Yes" : "No",
            }));
            baseData.productMetabolic = JSON.stringify(produkNeuroStatus);
          } else if (program === "PK to PBF") {
            baseData.tanggalPelaksanaan =
              document.getElementById("tanggalPK").value || "";
            baseData.jumlahPesertaPK =
              document.getElementById("jumlahPesertaPK").value || "";
          }

          console.log("Data yang dikirim:", baseData);

          Swal.fire({
            title: "Menyimpan...",
            didOpen: () => Swal.showLoading(),
            allowOutsideClick: false,
          });

          try {
            const res = await fetch(scriptURL, {
              method: "POST",
              body: JSON.stringify(baseData),
              headers: { "Content-Type": "text/plain;charset=utf-8" },
            });

            const result = await res.json(); // <--- penting! Ubah dari res.text() ke res.json()
            Swal.close();

            if (result.status === "Success") {
              Swal.fire("Berhasil", "Data berhasil disimpan.", "success");

              // Reset hanya field setelah biodata
              if (tomOutletSelect) tomOutletSelect.clear();
              $("#programEthical").val(null).trigger("change");
              $("#kodePiEthical").val("");
              $("#namaOutletEthical").val("");
              $("#kotaOutletEthical").val("");
              $("#alamatOutletEthical").val("");
              $("#jenisEwallet").val("");
              $("#noTelpEwallet").val("");
              $("#namaAkunEwallet").val("");
              $("#namaBank").val("");
              $("#noRek").val("");
              $("#namaAkunBank").val("");
              $("#cabangBank").val("");
              $("#tanggalRealisasiPop").val("");
              $("#tanggalRealisasiPgd").val("");
              $("#jumlahPesertaPop").val("");
              $("#jumlahPesertaPgd").val("");
              $("#confirmCheck").prop("checked", false);
              $("#namaApoteker").val("");
              $("#telpApoteker").val("");
              $("#emailApoteker").val("");
              $("#tanggalPK").val("");
              $("#namaOwnerInsentif").val("");
              $("#telpOwnerInsentif").val("");
              $("#totalSalesProgram").val("");
              $("#avgSalesProgram").val("");
              $("#tempatPelaksanaan").val("");
              $("#tanggalPresentasiNeuro").val("");
              $("#jumlahPesertaNeuro").val("");
              $("#biayaNeuro").val("");
              $("#jumlahPesertaPK").val("");
              $("#tanggalRealisasiPop").val("");
              $("#tanggalRealisasiPgd").val("");
              document
                .querySelectorAll('input[type="date"]')
                .forEach((el) => (el.value = ""));

              [
                "#Profibrat200",
                "#Stavinor10",
                "#Stavinor20",
                "#Stavinor40",
                "#Vastrol10",
                "#Vastrol20",
                "#Rechol10",
                "#Rechol20",
              ].forEach((id) => {
                const el = document.querySelector(id);
                if (el) el.checked = false;
              });

              // Sembunyikan field dinamis kembali
              $("#ewalletFields").addClass("d-none");
              $("#bankFields").addClass("d-none");
              $("#popPgdFields").addClass("d-none");
              $("#boostMetabolicFields").addClass("d-none");
              $("#produkSwitchWrapper").addClass("d-none");
              $("#tempatPelaksanaanWrapper").addClass("d-none");
              $("#tanggalPelaksanaanPK").addClass("d-none");
              $("#produkPediatrikWrapper").addClass("d-none");
              $("#salesPGDFields").addClass("d-none");
              $("#produkNeuroWrapper").addClass("d-none");
              $("#tanggalRealisasiPgdWrapper").addClass("d-none");
              $("#tanggalRealisasiPopWrapper").addClass("d-none");

              document
                .querySelectorAll(".produkPediatrikSwitch")
                .forEach((el) => (el.checked = false));

              // Hapus required dynamic
              setFieldRequired("#jenisEwallet", false);
              setFieldRequired("#noTelpEwallet", false);
              setFieldRequired("#namaAkunEwallet", false);
              setFieldRequired("#namaBank", false);
              setFieldRequired("#noRek", false);
              setFieldRequired("#namaAkunBank", false);
              setFieldRequired("#cabangBank", false);
              setFieldRequired("#tanggalRealisasiPop", false);
              setFieldRequired("#tanggalRealisasiPgd", false);
              setFieldRequired("#jumlahPesertaPop", false);
              setFieldRequired("#jumlahPesertaPgd", false);
              setFieldRequired("#namaApoteker", false);
              setFieldRequired("#telpApoteker", false);
              setFieldRequired("#emailApoteker", false);
              setFieldRequired("#tanggalPK", false);
              setFieldRequired("#tanggalPresentasiNeuro", false);
              setFieldRequired("#jumlahPesertaNeuro", false);
              setFieldRequired("#jumlahPesertaPK", false);
              setFieldRequired("#tempatPelaksanaan", false);
            } else if (result.status === "DUPLIKAT") {
              Swal.fire({
                icon: "error",
                title: "Kode PI sudah diisi",
                html: `
                  Pendaftaran program: <strong>${result.program}</strong><br>
                  Kode PI: <strong>${result.kodePi}</strong><br>
                  Telah diisi oleh: <strong>${result.oleh}</strong><br>
                  Pada: <strong>${result.tanggal}</strong>.
                `,
              });
            } else {
              Swal.fire({
                icon: "error",
                title: "Gagal Simpan Data",
                html:
                  result.message || "Terjadi kesalahan yang tidak diketahui.",
              });
            }
          } catch (error) {
            console.error("Submit error:", error);
            Swal.close();
            Swal.fire({
              icon: "error",
              title: "Gagal Submit",
              html: `Terjadi kesalahan pada sistem.<br><small>${
                error.message || error
              }</small>`,
            });
          }
        });

      $("#outletEthical").on("change", function () {
        const kodeOutlet = this.value;

        if (!kodeOutlet || !globalOutletData[kodeOutlet]) {
          // Jika tidak ada value atau outlet tidak ditemukan, kosongkan field terkait
          $("#kodePiEthical").val("");
          $("#namaOutletEthical").val("");
          $("#kotaOutletEthical").val("");
          $("#alamatOutletEthical").val("");
          return;
        }

        // Jika ada data outlet, isi otomatis
        const data = globalOutletData[kodeOutlet];
        $("#kodePiEthical").val(data.kodePi || "");
        $("#namaOutletEthical").val(data.nama || "");
        $("#kotaOutletEthical").val(data.kota || "");
        $("#alamatOutletEthical").val(data.alamat || "");
      });

      $("#programEthical").on("change", function () {
        const selected = $(this).val();

        $("#ewalletFields").addClass("d-none");
        $("#bankFields").addClass("d-none");
        $("#popPgdFields").addClass("d-none");
        $("#boostMetabolicFields").addClass("d-none");
        $("#produkSwitchWrapper").addClass("d-none");
        $("#tanggalPelaksanaanPK").addClass("d-none");
        $("#ownerFieldsInsentif").addClass("d-none");
        $("#produkPediatrikWrapper").addClass("d-none");
        $("#salesPGDFields").addClass("d-none");
        $("#presentasiNeuroFields").addClass("d-none");
        $("#tempatPelaksanaanWrapper").addClass("d-none");
        $("#pesertaPopWrapper").addClass("d-none");
        $("#produkSwitchWrapperPresentasi").html("");
        $("#pesertaPgdWrapper").addClass("d-none");
        $("#tanggalRealisasiPgdWrapper").addClass("d-none");
        $("#tanggalRealisasiPopWrapper").addClass("d-none");

        setFieldRequired("#jenisEwallet", false);
        setFieldRequired("#noTelpEwallet", false);
        setFieldRequired("#namaAkunEwallet", false);
        setFieldRequired("#namaBank", false);
        setFieldRequired("#noRek", false);
        setFieldRequired("#namaAkunBank", false);
        setFieldRequired("#cabangBank", false);
        setFieldRequired("#tanggalRealisasiPop", false);
        setFieldRequired("#tanggalRealisasiPgd", false);
        setFieldRequired("#jumlahPesertaPop", false);
        setFieldRequired("#jumlahPesertaPgd", false);
        setFieldRequired("#namaApoteker", false);
        setFieldRequired("#telpApoteker", false);
        setFieldRequired("#emailApoteker", false);
        setFieldRequired("#namaOwnerInsentif", false);
        setFieldRequired("#telpOwnerInsentif", false);
        setFieldRequired("#totalSalesProgram", false);
        setFieldRequired("#avgSalesProgram", false);
        setFieldRequired("#tanggalPresentasiNeuro", false);
        setFieldRequired("#jumlahPesertaNeuro", false);
        setFieldRequired("#jumlahPesertaPK", false);
        setFieldRequired("#tanggalPK", false);

        if (selected === "Insentif SC Modafil & Rozgra") {
          $("#ownerFieldsInsentif").removeClass("d-none");
          $("#ewalletFields").removeClass("d-none");
          setFieldRequired("#jenisEwallet", true);
          setFieldRequired("#noTelpEwallet", true);
          setFieldRequired("#namaAkunEwallet", true);
          setFieldRequired("#namaOwnerInsentif", true);
          setFieldRequired("#telpOwnerInsentif", true);
        } else if (selected === "POP") {
          $("#popPgdFields").removeClass("d-none");
          $("#produkPediatrikWrapper").removeClass("d-none");
          $("#tempatPelaksanaanWrapper").addClass("d-none");
          $("#pesertaPopWrapper").removeClass("d-none");
          $("#pesertaPgdWrapper").addClass("d-none");
          $("#tanggalRealisasiPopWrapper").removeClass("d-none");
          $("#tanggalRealisasiPgdWrapper").addClass("d-none");
          setFieldRequired("#tanggalRealisasiPop", true);
          setFieldRequired("#tanggalRealisasiPgd ", false);
          setFieldRequired("#jumlahPesertaPop", true);
          setFieldRequired("#jumlahPesertaPgd", false);
        } else if (selected === "PGD") {
          $("#popPgdFields").removeClass("d-none");
          $("#produkPediatrikWrapper").addClass("d-none");
          $("#tempatPelaksanaanWrapper").removeClass("d-none");
          $("#salesPGDFields").removeClass("d-none");
          $("#pesertaPopWrapper").addClass("d-none");
          $("#pesertaPgdWrapper").removeClass("d-none");
          $("#tanggalRealisasiPopWrapper").addClass("d-none");
          $("#tanggalRealisasiPgdWrapper").removeClass("d-none");
          setFieldRequired("#tanggalRealisasiPgd", true);
          setFieldRequired("#tanggalRealisasiPop ", false);
          setFieldRequired("#jumlahPesertaPgd", true);
          setFieldRequired("#jumlahPesertaPop", false);
          setFieldRequired("#tempatPelaksanaan", false);
          setFieldRequired("#totalSalesProgram", true);
          setFieldRequired("#avgSalesProgram", true);
        } else if (selected === "Boost Metabolic") {
          $("#boostMetabolicFields").removeClass("d-none");
          $("#produkSwitchWrapper").removeClass("d-none");
          setFieldRequired("#namaApoteker", true);
          setFieldRequired("#telpApoteker", true);
          setFieldRequired("#emailApoteker", true);
        } else if (selected === "PK to PBF") {
          $("#tanggalPelaksanaanPK").removeClass("d-none");
          setFieldRequired("#tanggalPK", true);
          setFieldRequired("#jumlahPesertaPK", true);
        } else if (selected === "Presentasi Produk Neuro Pain Metabolic") {
          setTimeout(initProdukNeuroSelect, 10);
          $("#presentasiNeuroFields").removeClass("d-none");
          setFieldRequired("#tanggalPresentasiNeuro", true);
          setFieldRequired("#jumlahPesertaNeuro", true);
        } else {
          $("#tanggalPelaksanaanPK").addClass("d-none");
          setFieldRequired("#tanggalPK", false);
          $("#pesertaPopWrapper").addClass("d-none");
          $("#pesertaPgdWrapper").addClass("d-none");
          setFieldRequired("#tanggalPresentasiNeuro", false);
          setFieldRequired("#jumlahPesertaNeuro", false);
          setFieldRequired("#jumlahPesertaPK", false);
        }
      });
      window.addEventListener("load", () => {
        const loader = document.getElementById("loader-wrapper");
        if (loader) {
          loader.classList.add("fade-out");
          setTimeout(() => loader.remove(), 500); // Hapus loader setelah animasi selesai
        }
        initTomSelectOutlet([]);
        flatpickr("#tanggalRealisasiPop", {
          dateFormat: "d/m/Y",
          allowInput: true,
          locale: "id",
        });
        flatpickr("#tanggalRealisasiPgd", {
          dateFormat: "d/m/Y",
          allowInput: true,
          locale: "id",
        });
        flatpickr("#tanggalPK", {
          dateFormat: "d/m/Y",
          allowInput: true,
          locale: "id",
        });
        flatpickr("#tanggalPresentasiNeuro", {
          dateFormat: "d/m/Y",
          allowInput: true,
          locale: "id",
        });
      });
      $("#totalSalesProgram").on("input", function () {
        const val = $(this).val().replace(/\D/g, "");
        $(this).val(formatRupiah(val));
        // Hitung avg otomatis
        let avg = "";
        if (val) {
          avg = Math.floor(Number(val) / 6);
        }
        $("#avgSalesProgram").val(formatRupiah(avg.toString()));
      });
      $("#jumlahPesertaNeuro").on("input", function () {
        const jumlah = parseInt($(this).val(), 10) || 0;
        const biaya = jumlah * 50000;
        $("#biayaNeuro").val(biaya ? formatRupiah(biaya.toString()) : "");
      });
      const produkNeuroList = [
        "ACETRAM 37.5/325MG FC TABLET",
        "INHIPUMP 40MG/10ML DRY INJECTION",
        "LANPRACID 30 MG CAPSULE",
        "APRION 150 MG CAPSULE",
        "APRION 75 MG CAPSULE",
        "LETHIRA 500 MG TABLET FC",
        "VERONIL 250 MG/5 ML SYRUP 120 ML",
        "DIZINE 10MG TAB 50`S",
        "DARVON 6 MG TABLET",
        "AMTOCORT 4 MG TABLET",
        "TORAS 4 MG TABLET",
        "TORAS 8 MG TABLET",
        "PLEXION 50MG TAB SC 100`S",
        "ACLONAC 25 TABLET FC",
        "ACLONAC 50 TABLET FC",
        "ACTREL 100 MG CAPSULE",
        "ACTREL 200 MG CAPSULE",
        "BLASTOFEN 25 MG FC TABLET",
        "BLASTOFEN 50 MG/2 ML INJECTION",
        "EVIDUR 120 MG FC TABLET",
        "FLEROXI 20 MG FLASH TABLET",
        "MELOXICAM 15MG TAB 30S (OGB)",
        "MOXAM 15",
        "MOXAM 7.5 MG TABLET",
        "SCELTO 30 INJEKSI",
        "MAGERIX 500 MCG CAPSULE",
        "ZEUFOR 1000 MG/8ML INJECTION",
        "ZEUFOR 500 MG TABLET",
        "UC-FLEX 40 MG TABLET",
      ];

      // Inisialisasi Tom Select pada produkNeuroSelect
      function initProdukNeuroSelect() {
        const select = document.getElementById("produkNeuroSelect");
        select.innerHTML = ""; // Kosongkan dulu
        produkNeuroList.forEach((produk) => {
          const opt = document.createElement("option");
          opt.value = produk;
          opt.textContent = produk;
          select.appendChild(opt);
        });
        if (window.produkNeuroTom) window.produkNeuroTom.destroy();
        window.produkNeuroTom = new TomSelect(select, {
          plugins: ["remove_button"],
          maxItems: null,
          create: false,
          placeholder: "Cari & Pilih produk",
          allowEmptyOption: true,
          closeAfterSelect: false,
          persist: false,
          searchField: ["text"],
        });
      }
      $(document).on("click", "#clearProdukNeuroBtn", function () {
        if (window.produkNeuroTom) {
          window.produkNeuroTom.clear();
        }
      });
    </script>
  </body>
</html>
